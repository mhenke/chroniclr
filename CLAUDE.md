# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**Chroniclr** is an AI-powered documentation automation system that generates project documentation from GitHub discussions. The system operates through a combination of GitHub Actions, Claude Code agents, and markdown templates to automatically create summaries, initiative briefs, changelogs, and meeting notes.

## Core Architecture

### Label-Based Document Routing
The system maps GitHub discussion labels to document types via `chroniclr.config.json`:
- `documentation`/`summary` → summary + meeting-notes
- `initiative`/`feature` → initiative-brief + summary  
- `release` → changelog
- `planning` → meeting-notes + summary

### Agent Pipeline
Document generation follows a multi-agent workflow:
1. **GitHub Actions** extracts discussion metadata and determines document types
2. **document-generator.md** processes discussion content using template variables
3. **content-analyzer.md** structures unorganized discussion content
4. **git-integration.md** creates PRs with branch naming: `docs/chroniclr-{discussion-number}`

### Template Variable System
Templates use a consistent variable replacement pattern:
- Common: `{title}`, `{date}`, `{status}`, `{participants}`, `{actionItems}`
- Summary-specific: `{objectives}`, `{progress}`, `{stakeholders}`, `{recentUpdates}`
- Initiative-specific: `{problemStatement}`, `{proposedSolution}`, `{timeline}`
- Changelog-specific: `{version}`, `{addedFeatures}`, `{fixedIssues}`

## Development Commands

```bash
# Node.js utilities (used by GitHub Actions)
npm install                    # Install dependencies
npm run validate-discussion    # Test discussion validation
npm run process-labels        # Test label-to-document-type mapping

# Test document generation locally
claude-code run .claude/agents/document-generator.md \
  --doc-type="summary" \
  --discussion-number="123" \
  --discussion-title="Project Planning" \
  --discussion-body="..." \
  --discussion-url="https://github.com/owner/repo/discussions/123"

# Manual document generation via slash commands
claude-code /generate-summary https://github.com/owner/repo/discussions/123
claude-code /create-brief https://github.com/owner/repo/discussions/456
claude-code /update-changelog v1.2.0
claude-code /sync-docs

# Test GitHub Actions workflow manually
gh workflow run chroniclr.yml -f discussion_number=123
```

## GitHub Actions Integration

The workflow in `.github/workflows/chroniclr.yml` expects these secrets:
- `GITHUB_TOKEN` (auto-provided)
- `CLAUDE_API_KEY` (must be configured)

### Workflow Architecture
1. **Node.js validation** (`npm run validate-discussion`) ensures discussion has required fields
2. **Label processing** (`npm run process-labels`) uses `chroniclr.config.json` mappings to determine document types
3. **Claude Code agents** generate documents for each type
4. **PR creation** with branch naming pattern `docs/chroniclr-{discussion-number}`

Generated files follow the pattern: `docs/{doc-type}-{discussion-number}.md`

## Template Development

When modifying templates in `src/templates/`:
1. Maintain the variable naming convention `{variableName}`
2. Include generation metadata footer: `*This document was automatically generated by Chroniclr from GitHub discussion #{discussionNumber}*`
3. Test variable substitution with the document-generator agent
4. Update corresponding agent documentation for new variables

## Adding New Document Types

1. **Create template** in `src/templates/{type}.md` using `{variable}` syntax
2. **Update label mapping** in `chroniclr.config.json` under `github.discussionLabels`
3. **Test locally** with `claude-code run .claude/agents/document-generator.md --doc-type={type}`
4. **Create slash command** in `.claude/commands/{type}.md` for manual generation

## Debugging Failed Generations

### Node.js Utilities Issues
- Check `npm run validate-discussion` output for missing required fields
- Verify `npm run process-labels` correctly maps labels from `chroniclr.config.json`
- Ensure Node.js version >= 18 (check `package.json` engines field)

### GitHub Actions Issues  
- GitHub API rate limits (workflow shows HTTP 403/429 errors)
- Missing `CLAUDE_API_KEY` secret (agent execution fails)
- Invalid discussion data (validation step fails)

### Document Generation Issues
- Missing discussion labels (defaults to "summary" document type)
- Template variable mismatch (content-analyzer output doesn't match template expectations)
- File path conflicts (check `docs/` directory structure)