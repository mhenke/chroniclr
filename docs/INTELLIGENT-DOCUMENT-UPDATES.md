# Intelligent Document Update System

This document describes the intelligent document update system that has been added to Chroniclr.

## Overview

The intelligent document update system automatically detects when documentation becomes outdated based on code changes and provides smart update capabilities that preserve manually edited sections.

## Key Components

### 1. DocumentTracker
- **Location**: `src/utils/document-tracker.js`
- **Purpose**: Tracks document versions, modification history, and dependencies
- **Features**:
  - Document metadata tracking with unique IDs
  - Version history with timestamps and change descriptions
  - Dependency tracking (which code files affect which docs)
  - Outdated document detection based on file changes
  - Comprehensive tracking reports

### 2. DocumentMerger
- **Location**: `src/utils/document-merger.js`
- **Purpose**: Smart merging algorithm that preserves manually edited sections
- **Features**:
  - AI-generated content markers (`<!-- AI_GENERATED_START/END -->`)
  - Manual edit preservation markers (`<!-- MANUAL_EDIT_START/END -->`)
  - Preserve markers for critical sections (`<!-- PRESERVE_START/END -->`)
  - Structured and unstructured document merging
  - Marker validation and integrity checking

### 3. DocumentUpdateManager
- **Location**: `src/utils/document-update-manager.js`
- **Purpose**: Central orchestrator for managing document updates
- **Features**:
  - Repository change analysis using existing FileAnalyzer
  - Update suggestion generation based on code changes
  - Batch document updating with content generation
  - Comprehensive update reporting with recommendations
  - Integration with tracking and merging systems

### 4. CLI Commands
- **Location**: `bin/chroniclr` (extended)
- **New Commands**:
  - `chroniclr update-docs` - Update documentation based on code changes
  - `chroniclr analyze-docs` - Analyze documentation status and generate suggestions
  - `chroniclr track-doc <file>` - Start tracking a documentation file
  - `chroniclr doc-status` - Show documentation tracking status and report

### 5. GitHub Workflow
- **Location**: `.github/workflows/document-updates.yml`
- **Purpose**: Automated documentation updates via GitHub Actions
- **Triggers**:
  - Push to main/develop branches
  - Merged pull requests
  - Scheduled weekly maintenance
  - Manual workflow dispatch

## Usage

### Manual CLI Usage

```bash
# Analyze current documentation status
chroniclr analyze-docs

# Update documentation automatically
chroniclr update-docs --auto

# Start tracking a document
chroniclr track-doc docs/API.md --type api-documentation

# View documentation status
chroniclr doc-status
```

### NPM Scripts

```bash
# Quick commands via package.json
npm run update-docs
npm run analyze-docs  
npm run doc-status
```

### Document Markers

The system uses special HTML comments to mark different sections:

#### AI-Generated Content
```markdown
<!-- AI_GENERATED_START -->
<!-- AI_TIMESTAMP: 2025-08-12T21:00:00.000Z -->
<!-- AI_VERSION: 1.2.0 -->

This content was generated by AI and will be updated automatically.

<!-- AI_GENERATED_END -->
```

#### Manual Edits
```markdown
<!-- MANUAL_EDIT_START -->
<!-- MANUAL_AUTHOR: username -->
<!-- MANUAL_TIMESTAMP: 2025-08-12T21:00:00.000Z -->

This content was manually edited and will be preserved during updates.

<!-- MANUAL_EDIT_END -->
```

#### Preserved Sections
```markdown
<!-- PRESERVE_START -->
<!-- PRESERVE_LABEL: critical-info -->

This content will always be preserved regardless of updates.

<!-- PRESERVE_END -->
```

## Configuration

The system is configured via `chroniclr.config.json`:

```json
{
  "documents": {
    "updateSystem": {
      "enabled": true,
      "trackingEnabled": true,
      "smartMerging": true,
      "preserveManualEdits": true,
      "updateFrequency": "on-change",
      "riskAssessment": true,
      "updateSuggestions": true,
      "generateReports": true
    },
    "dependencies": {
      "apiDocumentation": ["src/**/*.js", "src/**/*.ts", "routes/**/*"],
      "userGuide": ["src/components/**/*", "src/pages/**/*"],
      "securityDocs": ["**/auth*", "**/security*", "**/middleware*"]
    }
  }
}
```

## Integration with Existing System

The intelligent document update system integrates with existing Chroniclr components:

- **FileAnalyzer**: Uses existing file change analysis for detecting what docs need updates
- **ModularController**: Can be enabled/disabled via the modular configuration system
- **AI Document Generator**: Works alongside existing AI generation capabilities
- **GitHub Actions**: Integrates with existing workflow infrastructure

## Metadata Storage

The system stores metadata in `.chroniclr/metadata.json`:

```json
{
  "version": "1.0.0",
  "documents": {
    "abc123def456": {
      "id": "abc123def456",
      "path": "docs/API.md",
      "type": "api-documentation",
      "source": "ai",
      "version": "1.2.0",
      "createdAt": "2025-08-12T20:00:00.000Z",
      "updatedAt": "2025-08-12T21:00:00.000Z",
      "dependencies": ["src/api/*.js"],
      "updateHistory": [...]
    }
  }
}
```

## Testing

A comprehensive test suite is available:

```bash
# Run the document update system tests
node test-document-updates.js
```

The test validates:
- Document tracking functionality
- Smart merging with manual edit preservation
- Update manager analysis and suggestions
- End-to-end integration scenarios

## Future Enhancements

Potential future improvements:
- Integration with external documentation tools
- Advanced conflict resolution for complex merges
- Machine learning-based content quality assessment
- Multi-language documentation support
- Team collaboration features with review workflows